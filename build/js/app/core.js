define(["jquery","TweenMax","Modernizr","crossroads","hasher","app/overlay"],function(a,b,c,d,e,f){var g=0,h="reel/",i="reel",j="folio",k="",l="",m={},n=!1,o="http://flash.turbodrive.tv/",p=!0;CONFIG.debug;var q,r,s=function(){c.addTest("ipad",function(){return!!navigator.userAgent.match(/iPad/i)}),c.addTest("iphone",function(){return!!navigator.userAgent.match(/iPhone/i)}),c.addTest("ipod",function(){return!!navigator.userAgent.match(/iPod/i)}),c.addTest("android",function(){return!!navigator.userAgent.match(/android/i)}),c.addTest("ieMobile",function(){return!!navigator.userAgent.match(/IEMobile/i)}),c.addTest("ie",function(){return!!navigator.userAgent.match(/MSIE/i)}),c.addTest("ie2",function(){return!!navigator.userAgent.match(/Trident/i)}),c.addTest("appleios",function(){return c.ipad||c.ipod||c.iphone}),c.addTest("mobile",function(){return c.appleios||c.android||c.ieMobile}),c.addTest("highresdisplay",function(){if(window.matchMedia){var a=window.matchMedia("only screen and (-moz-min-device-pixel-ratio: 1.3), only screen and (-o-min-device-pixel-ratio: 2.6/2), only screen and (-webkit-min-device-pixel-ratio: 1.3), only screen  and (min-device-pixel-ratio: 1.3), only screen and (min-resolution: 1.3dppx)");if(a&&a.matches)return!0}}),p&&(!c.video||c.ie||c.ie2?window.location.href=o:c.mobile&&screen.height<1e3&&screen.width<1e3),c.addTest("firefox",function(){return navigator.userAgent.toLowerCase().indexOf("firefox")>-1}),c.addTest("chrome36",function(){return-1==navigator.userAgent.toLowerCase().indexOf("chrome")?!1:parseInt(window.navigator.appVersion.match(/Chrome\/(\d+)\./)[1],10)>35}),c.addTest("ios7",function(){return!!navigator.userAgent.match(/OS 7_\d/i)}),CONFIG.isRetina=c.highresdisplay,CONFIG.isiOs=c.appleios,CONFIG.isMobile=c.mobile,CONFIG.isFirefox=c.firefox,CONFIG.isChrome36=c.chrome36,d.addRoute("/{env}/{page}/",y),d.addRoute("/{env}/{page}/{section}/",x),document.ontouchmove=function(a){a.preventDefault()},f.on.clickMainOverlay.add(v),a(window).resize(cb),cb(null),f.loadGmd(),f.on.gmdLoaded.add(t),a(".buttonShare, .trackSocial").on("click",function(){var b=a(this).attr("data-network"),c=a(this).attr("data-action");ga("send","social",b,c,window.location)}),a(".trackEvent").on("click",function(){var b=a(this).attr("data-event").split(",");ga("send","event",b[0],b[1],b[1])})},t=function(){f.on.gmdLoaded.remove(t),db?u():r=u},u=function(){r=null,e.initialized.add(w),e.changed.add(w),e.init()},v=function(){if(m.header&&m.header.isOpen())m.header.close();else if(m.reel){var a=m.reel.getCurrentChapter();a&&(a.link?window.location.hash=a.link:CONFIG.debug&&a.debugLink&&(window.location.hash=a.debugLink))}},w=function(a){""==a&&e.setHash(h),"reel/"==a&&(a="reel/preintro/"),"folio/"==a&&e.setHash("folio","ikaf2/");var b="/"+a;ga("send","pageview",{page:b}),d.parse(a)},x=function(a,b,c){y(a,b,c)},y=function(b,c,d){var e=b==j;if(m.header&&m.header.close(),k==b){if(c==l){if(!d)return;D(c,d)}e?D(c,d):m.reel.seekToChapter(c,!0)}else""==k?e?(a("#reel").css("visibility","hidden"),f.show(f.LOADER),D(c,d)):(C(),M(c)):e?(m.reel.pause(),f.show(f.MINI_LOADER,.6),D(c,d)):M(c,z);l=c,k=b},z=function(){m.reel.on.readyToPlayAfterSeek.remove(z),m.reel.on.transitionComplete.add(A),m.reel.startTransition(!1),m.reel.resume(),V(!0)},A=function(){m.reel.on.transitionComplete.remove(A),m.folio.kill()},B=function(){m.header.updateState(l,m.folio.pageIsProject(l)),m.header.on.initialized.remove(B),m.reel&&m.reel.sleep()},C=function(){a("#folioContent").css("display","none")},D=function(b,c,d){m.folio?(d&&m.folio.on.readyForIntroTransition.add(d),m.folio.on.pageLoaded.add(K),m.folio.load(b,c)):(a("body").addClass("texture-background"),require(["app/folio"],function(a){m.folio=a,m.folio.on.initialized.add(I),d&&m.folio.on.readyForIntroTransition.add(d),m.folio.on.twPositionDefined.add(J),m.folio.on.creationProgress.add(f.updateProgress),m.folio.on.creationComplete.add(H),m.folio.on.pageCreationComplete.add(G),m.folio.on.pageLoading.add(F),m.folio.on.hireMeClicked.add(E),m.folio.init(b,c)}))},E=function(){m.header.openHireMe()},F=function(){m.folio.on.pageLoading.remove(F),f.show(f.MINI_LOADER,0)},G=function(){m.folio.on.pageCreationComplete.remove(G),f.hide(f.MINI_LOADER)},H=function(){m.folio.on.creationComplete.remove(H),m.folio.on.creationProgress.remove(f.updateProgress),f.disable()},I=function(a,b){m.folio.on.initialized.remove(I),m.folio.on.pageLoaded.add(K),m.folio.load(a,b)},J=function(a,b){m.header&&m.header.updateState(a,m.folio.pageIsProject(l)),b?e.setHash("folio",a+"/"+b+"/"):e.setHash("folio",a+"/")},K=function(a,b){Z(),m.folio.on.pageLoaded.remove(K),m.folio.hasCurrentPage3D()?m.folio.startTransition(a,b):(m.folio.on.readyForIntroTransition.add(L),m.folio.startIntroTransition(a,b))},L=function(a,b){if(m.folio.wakeup(a),f.disable(),m.folio.startTransition(a,b),m.reel&&(m.reel.sleep(),m.reel.startTransition(!0)),m.header)setTimeout(V,500,!1);else{var c=CONFIG.hyperDriveTransition?8e3:500;setTimeout(V,c,!1,B)}},M=function(a,b){if(f.loadGmd(),Y(),m.header&&m.header.updateState("reel",!1),m.reel){if(!a||!b)throw new Error("no chapter or handlerFunction defined");m.reel.on.readyToPlayAfterSeek.add(b),m.reel.wakeup(a)}else require(["app/reelPlayer"],function(c){m.reel=c,m.reel.on.playStarted.add(Q),m.reel.on.showHeader.add(R),m.reel.on.playGmd.add(S),m.reel.on.hideGmd.add(T),m.reel.on.enableOverlayClicks.add(f.enableClicks),m.reel.on.highlightButtonsHeader.add(N),m.reel.on.bufferFull.add(f.onBufferFull),m.reel.on.bufferEmpty.add(f.onBufferEmpty),m.reel.on.bufferProgress.add(f.onBufferProgress),m.reel.on.videoComplete.add(U),m.reel.on.changeChapter.add(O),b&&m.reel.on.readyToPlayAfterSeek.add(b),m.reel.init(a),CONFIG.isMobile&&m.reel.on.mobileCTAReady.add(P)})},N=function(){m.header&&m.header.highlightButtons()},O=function(a){e.setHash("reel",a.id+"/")},P=function(){m.reel.on.mobileCTAReady.remove(P),f.hide()},Q=function(){m.reel.on.playStarted.remove(Q),f.hide()},R=function(){V(!0)},S=function(){f.show(f.GETMOREDETAILS)},T=function(a){f.hide(f.GETMOREDETAILS,a)},U=function(){e.setHash("folio","about/")},V=function(a,b){m.header?m.header.show(a):require(["app/header"],function(c){m.header=c,m.header.on.close.add(W),b&&m.header.on.initialized.add(b),m.header.on.open.add(X),m.header.init(),m.header.show(a)})},W=function(){m.reel&&m.reel.isActive()&&m.reel.resume(),f.gmdLoaded()&&f.resumeGmd()},X=function(){m.reel&&m.reel.isActive()&&m.reel.pause(),f.gmdLoaded()&&f.pauseGmd()},Y=function(){document.removeEventListener("touchstart",_,!1),document.removeEventListener("touchmove",ab,!1),document.removeEventListener("touchend",bb,!1),n=!1},Z=function(){n||(document.addEventListener("touchstart",_,!1),document.addEventListener("touchmove",ab,!1),document.addEventListener("touchend",bb,!1),n=!0)},$=function(b){if(a(b).is("a")){var c=a(b).attr("href"),d=a(b).attr("target");if("#"!=c)return d&&"_self"!=d?(window.open(c,d),!0):(0==c.indexOf("#/")?(c=c.slice(2),e.setHash(c)):window.open(c,d),!0)}return!1},_=function(a){a.preventDefault(),q=a.target,m.folio&&m.folio.onTouchStart(a),m.header&&m.header.close()},ab=function(a){a.preventDefault(),m.folio&&m.folio.onTouchMove(a)},bb=function(a){a.preventDefault();var b=a.target;m.folio&&m.folio.onTouchEnd(a),b==q&&($(b)||(m.header&&m.header.onTouchClick(b),m.folio&&m.folio.onTouchClick(b))),q=null},cb=function(){eb(),LAYOUT.viewportH=window.innerHeight,LAYOUT.viewportW=window.innerWidth,LAYOUT.vH2=.5*LAYOUT.viewportH,LAYOUT.vW2=.5*LAYOUT.viewportW,LAYOUT.ratioH=LAYOUT.getRatioH(LAYOUT.viewportH),LAYOUT.ratioW=LAYOUT.getRatioW(LAYOUT.viewportW),LAYOUT._rX=LAYOUT.initW/LAYOUT.viewportW,LAYOUT._rY=LAYOUT.initH/LAYOUT.viewportH;var c=LAYOUT.viewportH/LAYOUT.viewportW*35.13+20,d=c*Math.PI/180;LAYOUT_3D.PX_PERFECT_DISTANCE=-(LAYOUT.viewportH/2)/Math.tan(d/2),LAYOUT_3D.fovMult001=(LAYOUT_3D.PX_PERFECT_DISTANCE+526)/-966,m.header&&m.header.resize(),m.reel&&m.reel.resize(),m.folio&&m.folio.resize(),LAYOUT.currentEnv==j&&b.set(a(i),{y:-g-200}),a(i).css("height",g)},db=!0,eb=function(){if(CONFIG.isMobile){var b=a(window).width()>a(window).height();db&&!b?(f.show(f.LANDSCAPE_ALERT),m.reel&&m.reel.isActive()&&m.reel.pause()):!db&&b&&(f.hide(f.LANDSCAPE_ALERT),r&&r(),m.reel&&m.reel.isActive()&&m.reel.resume()),db=b}};s()});